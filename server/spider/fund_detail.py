import time

import asyncio
import aiohttp
import execjs

FUND_LIST_GET_URL = "http://fund.eastmoney.com/Data/Fund_JJJZ_Data.aspx"
FUND_NET_VALUE_URL = "http://api.fund.eastmoney.com/f10/lsjz"
FUND_DETAIL_URL = "http://fund.eastmoney.com/pingzhongdata/{}.js"

"""
/*基金或股票信息*/
var fS_name = "泓德裕泰债券A";
var fS_code = "002138";
/*原费率*/
var fund_sourceRate = "0.80";
/*现费率*/
var fund_Rate = "0.08";
/*最小申购金额*/
var fund_minsg = "100";
/*基金持仓股票代码*/
var stockCodes = [];
/*基金持仓债券代码*/
var zqCodes = "1361391,1086022,0180071";
/*基金持仓股票代码(新市场号)*/
var stockCodesNew = [];
/*基金持仓债券代码（新市场号）*/
var zqCodesNew = "1.136139,0.108602,1.018007";
/*收益率*/
/*近一年收益率*/
var syl_1n = "12.2544";
/*近6月收益率*/
var syl_6y = "12.0448";
/*近三月收益率*/
var syl_3y = "4.4387";
/*近一月收益率*/
var syl_1y = "2.1276";
/*股票仓位测算图*/
var Data_fundSharesPositions = [];
/*单位净值走势 equityReturn-净值回报 unitMoney-每份派送金*/
var Data_netWorthTrend = []
/*累计净值走势*/
var Data_ACWorthTrend = [];
/*累计收益率走势*/
var Data_grandTotal = [];
/*同类排名走势*/
var Data_rateInSimilarType = [{
    "x": 1458144000000,
    "y": 237,
    "sc": "638"
}];

var Data_rateInSimilarPersent = [[1458144000000, 62.8500], [1458230400000, 61.4000], [1458489600000, 67.5000], [1458576000000, 69.5800], [1458662400000, 70.0900], [1458748800000, 77.1000], [1458835200000, 51.8900], [1459094400000, 40.6200], [1459180800000, 43.8300], [1459267200000, 39.2000], [1459353600000, 37.9600], [1459440000000, 38.1400], [1459785600000, 26.3500], [1459872000000, 29.2100], [1459958400000, 21.9100], [1460044800000, 24.2900], [1460304000000, 14.4600], [1460390400000, 17.4100], [1460476800000, 13.7100], [1460563200000, 19.4100], [1460649600000, 16.1400], [1460908800000, 20.8000], [1460995200000, 21.1700], [1461081600000, 22.2700], [1461168000000, 32.0600], [1461254400000, 30.2100], [1461513600000, 36.4900], [1461600000000, 31.7600], [1461686400000, 34.5000], [1461772800000, 30.0800], [1461859200000, 35.0100], [1462204800000, 30.1200], [1462291200000, 33.7300], [1462377600000, 32.0800], [1462464000000, 33.5300], [1462723200000, 34.9800], [1462809600000, 30.9800], [1462896000000, 30.2300], [1462982400000, 27.9700], [1463068800000, 27.6700], [1463328000000, 22.7900], [1463414400000, 21.4700], [1463500800000, 26.2800], [1463587200000, 25.2300], [1463673600000, 23.8300], [1463932800000, 21.4600], [1464019200000, 22.8700], [1464105600000, 12.6900], [1464192000000, 15.7500], [1464278400000, 15.0700], [1464537600000, 9.4700], [1464624000000, 8.0200], [1464710400000, 9.9600], [1464796800000, 12.9300], [1464883200000, 10.7100], [1465142400000, 8.8800], [1465228800000, 10.8300], [1465315200000, 11.5600], [1465747200000, 12.2200], [1465833600000, 11.0800], [1465920000000, 10.5900], [1466006400000, 10.1200], [1466092800000, 11.6200], [1466352000000, 15.9100], [1466438400000, 19.1800], [1466524800000, 15.5700], [1466611200000, 16.8600], [1466697600000, 15.2500], [1466956800000, 35.9800], [1467043200000, 62.1700], [1467129600000, 57.1400], [1467216000000, 82.6100], [1467302400000, 76.6100], [1467561600000, 74.3600], [1467648000000, 77.5900], [1467734400000, 74.3200], [1467820800000, 86.6300], [1467907200000, 85.9900], [1468166400000, 89.7900], [1468252800000, 86.6700], [1468339200000, 87.1300], [1468425600000, 84.1600], [1468512000000, 88.5500], [1468771200000, 84.5100], [1468857600000, 83.1900], [1468944000000, 73.6000], [1469030400000, 62.2400], [1469116800000, 62.3500], [1469376000000, 51.7400], [1469462400000, 43.6500], [1469548800000, 56.4900], [1469635200000, 53.8200], [1469721600000, 60.3300], [1469980800000, 65.1000], [1470067200000, 61.6700], [1470153600000, 67.5000], [1470240000000, 66.9900], [1470326400000, 68.7000], [1470585600000, 63.9900], [1470672000000, 62.0500], [1470758400000, 62.3300], [1470844800000, 64.5500], [1470931200000, 60.6200], [1471190400000, 52.8000], [1471276800000, 60.7700], [1471363200000, 61.5600], [1471449600000, 58.2000], [1471536000000, 61.2700], [1471795200000, 61.4900], [1471881600000, 66.2600], [1471968000000, 65.4500], [1472054400000, 66.8500], [1472140800000, 62.0400], [1472400000000, 65.6400], [1472486400000, 70.9100], [1472572800000, 74.8300], [1472659200000, 76.0400], [1472745600000, 76.7600], [1473004800000, 76.7300], [1473091200000, 74.00], [1473177600000, 69.2000], [1473264000000, 72.5800], [1473350400000, 73.1200], [1473609600000, 82.2300], [1473696000000, 77.0600], [1473782400000, 79.4000], [1474214400000, 79.6300], [1474300800000, 82.0900], [1474387200000, 80.1300], [1474473600000, 80.00], [1474560000000, 82.3800], [1474819200000, 82.0500], [1474905600000, 86.7000], [1474992000000, 87.9400], [1475078400000, 86.5300], [1475164800000, 81.3700], [1476028800000, 69.8100], [1476115200000, 63.1800], [1476201600000, 67.4400], [1476288000000, 73.4900], [1476374400000, 72.3300], [1476633600000, 73.3100], [1476720000000, 71.4800], [1476806400000, 72.1200], [1476892800000, 65.7800], [1476979200000, 88.6400], [1477238400000, 86.1800], [1477324800000, 86.1500], [1477411200000, 92.0700], [1477497600000, 81.3500], [1477584000000, 82.9100], [1477843200000, 80.7000], [1477929600000, 76.9000], [1478016000000, 82.4000], [1478102400000, 79.6000], [1478188800000, 81.9300], [1478448000000, 81.7500], [1478534400000, 83.1100], [1478620800000, 84.5000], [1478707200000, 84.0100], [1478793600000, 81.8500], [1479052800000, 84.5000], [1479139200000, 90.8100], [1479225600000, 89.00], [1479312000000, 90.3700], [1479398400000, 93.4400], [1479657600000, 92.6900], [1479744000000, 87.9400], [1479830400000, 87.8200], [1479916800000, 87.2000], [1480003200000, 85.7800], [1480262400000, 86.3300], [1480348800000, 85.9900], [1480435200000, 86.0400], [1480521600000, 85.6800], [1480608000000, 89.0800], [1480867200000, 93.2000], [1480953600000, 95.0600], [1481040000000, 95.0100], [1481126400000, 95.3300], [1481212800000, 94.4600], [1481472000000, 93.7700], [1481558400000, 94.2300], [1481644800000, 93.7600], [1481731200000, 93.2000], [1481817600000, 92.9900], [1482076800000, 93.7200], [1482163200000, 94.4300], [1482249600000, 93.9700], [1482336000000, 95.4700], [1482422400000, 95.5500], [1482681600000, 94.9400], [1482768000000, 95.3900], [1482854400000, 95.7300], [1482940800000, 96.1900], [1483027200000, 97.5700], [1483372800000, 97.0900], [1483459200000, 97.0900], [1483545600000, 97.2000], [1483632000000, 97.2400], [1483891200000, 96.3100], [1483977600000, 97.4200], [1484064000000, 98.0900], [1484150400000, 98.0900], [1484236800000, 98.1300], [1484496000000, 97.9900], [1484582400000, 98.1000], [1484668800000, 98.00], [1484755200000, 98.1200], [1484841600000, 98.0400], [1485100800000, 95.3800], [1485187200000, 96.3600], [1485273600000, 95.4700], [1485360000000, 94.5900], [1486051200000, 94.1000], [1486310400000, 92.5600], [1486396800000, 93.1200], [1486483200000, 92.4100], [1486569600000, 92.3100], [1486656000000, 92.8300], [1486915200000, 92.1100], [1487001600000, 92.2000], [1487088000000, 92.00], [1487174400000, 94.7200], [1487260800000, 94.0900], [1487520000000, 92.5700], [1487606400000, 93.0600], [1487692800000, 93.2700], [1487779200000, 92.3200], [1487865600000, 93.6000], [1488124800000, 92.9900], [1488211200000, 94.9600], [1488297600000, 96.1500], [1488384000000, 95.9600], [1488470400000, 95.7000], [1488729600000, 95.9000], [1488816000000, 96.2300], [1488902400000, 95.0800], [1488988800000, 96.2400], [1489075200000, 96.1700], [1489334400000, 95.3000], [1489420800000, 95.3900], [1489507200000, 95.2100], [1489593600000, 95.3500], [1489680000000, 96.9000], [1489939200000, 93.8900], [1490025600000, 95.1200], [1490112000000, 94.7900], [1490198400000, 93.3900], [1490284800000, 92.6000], [1490544000000, 94.0400], [1490630400000, 94.0300], [1490716800000, 93.8500], [1490803200000, 90.8200], [1490889600000, 92.1500], [1491321600000, 89.8900], [1491408000000, 89.3400], [1491494400000, 90.5900], [1491753600000, 89.7500], [1491840000000, 88.8500], [1491926400000, 89.2100], [1492012800000, 87.8600], [1492099200000, 90.2600], [1492358400000, 90.3900], [1492444800000, 91.6100], [1492531200000, 90.0900], [1492617600000, 91.6700], [1492704000000, 92.6100], [1492963200000, 89.4500], [1493049600000, 92.1700], [1493136000000, 92.9600], [1493222400000, 92.0800], [1493308800000, 94.3100], [1493654400000, 93.5800], [1493740800000, 92.4300], [1493827200000, 92.7900], [1493913600000, 92.6800], [1494172800000, 97.0100], [1494259200000, 96.5700], [1494345600000, 94.9200], [1494432000000, 94.6500], [1494518400000, 93.9200], [1494777600000, 94.8400], [1494864000000, 89.7300], [1494950400000, 89.1700], [1495036800000, 89.3400], [1495123200000, 92.6200], [1495382400000, 94.8200], [1495468800000, 94.9000], [1495555200000, 91.7800], [1495641600000, 90.4000], [1495728000000, 90.3200], [1496160000000, 91.7500], [1496246400000, 88.2200], [1496332800000, 87.3400], [1496592000000, 90.5500], [1496678400000, 91.0600], [1496764800000, 89.2200], [1496851200000, 87.8100], [1496937600000, 86.1800], [1497196800000, 87.9400], [1497283200000, 87.8700], [1497369600000, 90.8600], [1497456000000, 81.6700], [1497542400000, 87.1300], [1497801600000, 85.8300], [1497888000000, 82.6700], [1497974400000, 84.7500], [1498060800000, 85.4900], [1498147200000, 84.6900], [1498406400000, 83.9600], [1498492800000, 82.4100], [1498579200000, 82.8400], [1498665600000, 84.4900], [1498752000000, 83.2400], [1499011200000, 81.4600], [1499097600000, 83.0100], [1499184000000, 80.1300], [1499270400000, 83.1400], [1499356800000, 80.5800], [1499616000000, 81.0400], [1499702400000, 76.6700], [1499788800000, 79.8500], [1499875200000, 79.2400], [1499961600000, 79.3400], [1500220800000, 80.6300], [1500307200000, 77.3400], [1500393600000, 76.2400], [1500480000000, 72.5100], [1500566400000, 70.4100], [1500825600000, 68.0800], [1500912000000, 68.5900], [1500998400000, 70.2700], [1501084800000, 66.4300], [1501171200000, 61.2300], [1501430400000, 57.6600], [1501516800000, 57.9600], [1501603200000, 63.5900], [1501689600000, 62.2800], [1501776000000, 58.5000], [1502035200000, 55.9600], [1502121600000, 52.0100], [1502208000000, 54.5900], [1502294400000, 49.5200], [1502380800000, 49.7200], [1502640000000, 49.5600], [1502726400000, 50.6800], [1502812800000, 50.8800], [1502899200000, 50.4800], [1502985600000, 50.4800], [1503244800000, 43.7800], [1503331200000, 45.0700], [1503417600000, 39.7300], [1503504000000, 42.2200], [1503590400000, 42.9100], [1503849600000, 42.4700], [1503936000000, 38.7900], [1504022400000, 39.7800], [1504108800000, 32.1900], [1504195200000, 36.8500], [1504454400000, 36.3600], [1504540800000, 38.0300], [1504627200000, 38.3100], [1504713600000, 37.3600], [1504800000000, 41.7000], [1505059200000, 46.4000], [1505145600000, 44.5400], [1505232000000, 46.8700], [1505318400000, 40.4400], [1505404800000, 50.0400], [1505664000000, 49.6500], [1505750400000, 53.9600], [1505836800000, 59.2200], [1505923200000, 56.0200], [1506009600000, 52.5200], [1506268800000, 53.5200], [1506355200000, 55.9400], [1506441600000, 52.5400], [1506528000000, 54.0100], [1506614400000, 52.3200], [1507478400000, 50.5400], [1507564800000, 53.7400], [1507651200000, 62.1500], [1507737600000, 51.3600], [1507824000000, 53.8600], [1508083200000, 51.0100], [1508169600000, 47.9800], [1508256000000, 50.9400], [1508342400000, 54.7600], [1508428800000, 67.00], [1508688000000, 63.6300], [1508774400000, 58.9600], [1508860800000, 57.9600], [1508947200000, 58.3500], [1509033600000, 65.4300], [1509292800000, 64.5700], [1509379200000, 69.4300], [1509465600000, 68.7900], [1509552000000, 63.5100], [1509638400000, 63.8500], [1509897600000, 66.8200], [1509984000000, 67.2300], [1510070400000, 72.9900], [1510156800000, 72.1000], [1510243200000, 69.4700], [1510502400000, 65.7700], [1510588800000, 67.7700], [1510675200000, 71.7100], [1510761600000, 70.4800], [1510848000000, 71.2300], [1511107200000, 73.2400], [1511193600000, 73.5400], [1511280000000, 76.0300], [1511366400000, 80.6300], [1511452800000, 79.8900], [1511712000000, 89.1400], [1511798400000, 89.9900], [1511884800000, 91.2800], [1511971200000, 93.0600], [1512057600000, 92.1500], [1512316800000, 93.6000], [1512403200000, 92.9200], [1512489600000, 93.7500], [1512576000000, 94.0600], [1512662400000, 94.0300], [1512921600000, 92.2900], [1513008000000, 93.2800], [1513094400000, 92.3700], [1513180800000, 92.6000], [1513267200000, 93.4300], [1513526400000, 92.6000], [1513612800000, 91.5100], [1513699200000, 92.00], [1513785600000, 90.7100], [1513872000000, 90.7900], [1514131200000, 91.9200], [1514217600000, 91.0900], [1514304000000, 92.9200], [1514390400000, 90.7100], [1514476800000, 91.6600], [1514822400000, 89.5400], [1514908800000, 89.7700], [1514995200000, 88.8500], [1515081600000, 88.5000], [1515340800000, 88.8500], [1515427200000, 88.8400], [1515513600000, 88.7600], [1515600000000, 88.2300], [1515686400000, 88.0300], [1515945600000, 89.4500], [1516032000000, 87.6900], [1516118400000, 88.9100], [1516204800000, 88.00], [1516291200000, 87.7000], [1516550400000, 84.9600], [1516636800000, 83.6200], [1516723200000, 83.0600], [1516809600000, 82.7300], [1516896000000, 82.2800], [1517155200000, 88.4300], [1517241600000, 89.9000], [1517328000000, 89.7500], [1517414400000, 91.1300], [1517500800000, 89.6900], [1517760000000, 88.6100], [1517846400000, 92.8400], [1517932800000, 94.6800], [1518019200000, 94.8300], [1518105600000, 96.1000], [1518364800000, 96.4500], [1518451200000, 96.7700], [1518537600000, 96.0300], [1519228800000, 94.7800], [1519315200000, 93.4600], [1519574400000, 91.7100], [1519660800000, 89.6400], [1519747200000, 90.1800], [1519833600000, 90.0200], [1519920000000, 92.2300], [1520179200000, 91.1700], [1520265600000, 87.8200], [1520352000000, 89.4300], [1520438400000, 88.4300], [1520524800000, 86.8600], [1520784000000, 85.3600], [1520870400000, 88.7400], [1520956800000, 90.2700], [1521043200000, 87.9500], [1521129600000, 89.7300], [1521388800000, 91.5400], [1521475200000, 90.7500], [1521561600000, 92.4400], [1521648000000, 93.1400], [1521734400000, 93.5000], [1521993600000, 92.7500], [1522080000000, 89.9000], [1522166400000, 92.5200], [1522252800000, 91.4400], [1522339200000, 89.4400], [1522598400000, 90.5800], [1522684800000, 88.1900], [1522771200000, 88.2900], [1523203200000, 91.8100], [1523289600000, 90.5900], [1523376000000, 76.0600], [1523462400000, 75.5200], [1523548800000, 79.1900], [1523808000000, 73.2800], [1523894400000, 73.8200], [1523980800000, 67.00], [1524067200000, 68.8600], [1524153600000, 69.5900], [1524412800000, 71.8600], [1524499200000, 73.0700], [1524585600000, 70.6100], [1524672000000, 73.7000], [1524758400000, 74.5400], [1525190400000, 82.9100], [1525276800000, 82.3400], [1525363200000, 81.2600], [1525622400000, 77.4000], [1525708800000, 46.0900], [1525795200000, 41.1400], [1525881600000, 36.5800], [1525968000000, 28.3200], [1526227200000, 29.2900], [1526313600000, 28.9200], [1526400000000, 30.3400], [1526486400000, 35.5000], [1526572800000, 29.6400], [1526832000000, 27.4800], [1526918400000, 42.1600], [1527004800000, 44.6400], [1527091200000, 45.1900], [1527177600000, 45.1100], [1527436800000, 45.3400], [1527523200000, 50.3500], [1527609600000, 44.2900], [1527696000000, 42.8100], [1527782400000, 43.7500], [1528041600000, 35.3400], [1528128000000, 33.8800], [1528214400000, 38.1800], [1528300800000, 32.7900], [1528387200000, 36.0600], [1528646400000, 39.3700], [1528732800000, 39.8400], [1528819200000, 39.6600], [1528905600000, 39.3600], [1528992000000, 38.0700], [1529337600000, 38.0200], [1529424000000, 37.9500], [1529510400000, 38.0200], [1529596800000, 38.8700], [1529856000000, 39.1300], [1529942400000, 38.5700], [1530028800000, 40.7600], [1530115200000, 36.9000], [1530201600000, 37.5500], [1530460800000, 39.5300], [1530547200000, 39.0300], [1530633600000, 37.9400], [1530720000000, 37.1600], [1530806400000, 29.5900], [1531065600000, 25.7600], [1531152000000, 26.9900], [1531238400000, 32.9200], [1531324800000, 30.4000], [1531411200000, 25.8300], [1531670400000, 25.5900], [1531756800000, 21.5300], [1531843200000, 22.3700], [1531929600000, 24.0800], [1532016000000, 16.9500], [1532275200000, 12.2200], [1532361600000, 14.3400], [1532448000000, 15.5200], [1532534400000, 14.6900], [1532620800000, 16.6800], [1532880000000, 17.5800], [1532966400000, 16.0900], [1533052800000, 18.0500], [1533139200000, 16.0200], [1533225600000, 17.4300], [1533484800000, 19.5300], [1533571200000, 19.00], [1533657600000, 26.2900], [1533744000000, 24.7500], [1533830400000, 27.7000], [1534089600000, 31.2700], [1534176000000, 32.8900], [1534262400000, 34.6100], [1534348800000, 35.8700], [1534435200000, 35.4300], [1534694400000, 37.9400], [1534780800000, 38.6700], [1534867200000, 33.9800], [1534953600000, 33.7500], [1535040000000, 32.4000], [1535299200000, 31.0700], [1535385600000, 33.8800], [1535472000000, 29.9800], [1535558400000, 32.0600], [1535644800000, 35.1900], [1535904000000, 32.7100], [1535990400000, 36.0500], [1536076800000, 40.00], [1536163200000, 38.5600], [1536249600000, 43.3900], [1536508800000, 47.2500], [1536595200000, 46.2400], [1536681600000, 45.6200], [1536768000000, 47.4900], [1536854400000, 43.8400], [1537113600000, 49.6500], [1537200000000, 51.7300], [1537286400000, 45.5000], [1537372800000, 46.9200], [1537459200000, 46.4800], [1537804800000, 49.4600], [1537891200000, 46.7400], [1537977600000, 44.6700], [1538064000000, 45.5400], [1538928000000, 92.6400], [1539014400000, 91.5600], [1539100800000, 90.4000], [1539187200000, 91.7800], [1539273600000, 91.0100], [1539532800000, 94.2400], [1539619200000, 96.0100], [1539705600000, 97.8400], [1539792000000, 97.9200], [1539878400000, 96.4900], [1540137600000, 98.4600], [1540224000000, 87.2200], [1540310400000, 89.9900], [1540396800000, 90.4100], [1540483200000, 91.7800], [1540742400000, 91.9500], [1540828800000, 91.0100], [1540915200000, 94.2300], [1541001600000, 94.7000], [1541088000000, 93.8600], [1541347200000, 95.5900], [1541433600000, 95.0600], [1541520000000, 96.8800], [1541606400000, 96.3600], [1541692800000, 96.0800], [1541952000000, 94.8600], [1542038400000, 92.4100], [1542124800000, 87.1800], [1542211200000, 81.9600], [1542297600000, 73.8400], [1542556800000, 73.1400], [1542643200000, 86.9800], [1542729600000, 87.8900], [1542816000000, 84.3600], [1542902400000, 86.7100], [1543161600000, 90.0700], [1543248000000, 88.0800], [1543334400000, 85.3400], [1543420800000, 86.0200], [1543507200000, 63.2900], [1543766400000, 63.6800], [1543852800000, 57.4700], [1543939200000, 53.5700], [1544025600000, 52.7000], [1544112000000, 51.4700], [1544371200000, 40.4600], [1544457600000, 37.8400], [1544544000000, 36.6400], [1544630400000, 35.7900], [1544716800000, 44.6300], [1544976000000, 48.2400], [1545062400000, 45.3700], [1545148800000, 59.7900], [1545235200000, 59.8500], [1545321600000, 58.2500], [1545580800000, 61.2200], [1545667200000, 55.6500], [1545753600000, 56.5500], [1545840000000, 56.7200], [1545926400000, 53.3000], [1546358400000, 54.8500], [1546444800000, 54.9300], [1546531200000, 56.1000], [1546790400000, 54.8600], [1546876800000, 45.2100], [1546963200000, 43.3100], [1547049600000, 46.2700], [1547136000000, 34.0400], [1547395200000, 39.4900], [1547481600000, 33.6700], [1547568000000, 29.3900], [1547654400000, 30.9800], [1547740800000, 30.6600], [1548000000000, 41.5600], [1548086400000, 48.5400], [1548172800000, 78.2000], [1548259200000, 78.3400], [1548345600000, 75.5200], [1548604800000, 79.6400], [1548691200000, 78.9200], [1548777600000, 79.8600], [1548864000000, 79.9400], [1548950400000, 56.9800], [1549814400000, 25.0700], [1549900800000, 22.5100], [1549987200000, 21.8400], [1550073600000, 23.1800], [1550160000000, 25.8600], [1550419200000, 26.5000], [1550505600000, 21.00], [1550592000000, 8.5900], [1550678400000, 7.0200], [1550764800000, 9.6300], [1551024000000, 7.3900], [1551110400000, 7.1100], [1551196800000, 7.5100], [1551283200000, 22.3100], [1551369600000, 24.5600], [1551628800000, 27.4100], [1551715200000, 25.2600], [1551801600000, 21.0900], [1551888000000, 19.6500], [1551974400000, 22.7300], [1552233600000, 33.7800], [1552320000000, 26.9900], [1552406400000, 21.9000], [1552492800000, 46.1200], [1552579200000, 35.9300], [1552838400000, 45.8100], [1552924800000, 3.4600], [1553011200000, 3.1300], [1553097600000, 3.5200], [1553184000000, 4.1600], [1553443200000, 2.7600], [1553529600000, 3.0800], [1553616000000, 3.0100], [1553702400000, 3.00], [1553788800000, 2.4000], [1554048000000, 2.8100], [1554134400000, 3.7300], [1554220800000, 4.3700], [1554307200000, 3.8900], [1554652800000, 3.7100], [1554739200000, 5.3400], [1554825600000, 4.8100], [1554912000000, 6.1800], [1554998400000, 6.7900], [1555257600000, 7.6700], [1555344000000, 8.0600], [1555430400000, 8.5000], [1555516800000, 6.5200], [1555603200000, 5.9000], [1555862400000, 4.0500], [1555948800000, 5.7100], [1556035200000, 6.0700], [1556121600000, 6.9800], [1556208000000, 6.7000], [1556467200000, 6.6300], [1556553600000, 4.9300], [1557072000000, 16.7900], [1557158400000, 18.5900], [1557244800000, 16.9600], [1557331200000, 19.2100], [1557417600000, 3.6100], [1557676800000, 8.5600], [1557763200000, 6.2400], [1557849600000, 5.6800], [1557936000000, 5.1200], [1558022400000, 7.6400], [1558281600000, 10.6300], [1558368000000, 11.9300], [1558454400000, 15.2500], [1558540800000, 17.6000], [1558627200000, 20.0500], [1558886400000, 21.5300], [1558972800000, 22.7600], [1559059200000, 21.9000], [1559145600000, 22.6700], [1559232000000, 22.4800], [1559491200000, 26.3400], [1559577600000, 29.2000], [1559664000000, 29.8400], [1559750400000, 32.4800], [1560096000000, 28.6200], [1560182400000, 29.5600], [1560268800000, 36.0300], [1560355200000, 34.9500], [1560441600000, 23.1600], [1560700800000, 25.4500], [1560787200000, 26.5600], [1560873600000, 61.8800], [1560960000000, 54.6600], [1561046400000, 35.3900], [1561305600000, 33.3700], [1561392000000, 37.2000], [1561478400000, 34.0100], [1561564800000, 33.00], [1561651200000, 32.7000], [1561910400000, 38.0300], [1561996800000, 33.8900], [1562083200000, 33.0400], [1562169600000, 39.4300], [1562256000000, 38.8200], [1562515200000, 37.0300], [1562601600000, 35.6400], [1562688000000, 34.1400], [1562774400000, 29.8800], [1562860800000, 28.1500], [1563120000000, 27.0400], [1563206400000, 30.2900], [1563292800000, 30.3900], [1563379200000, 31.5400], [1563465600000, 34.9700], [1563724800000, 37.4900], [1563811200000, 29.4600], [1563897600000, 31.3500], [1563984000000, 20.4300], [1564070400000, 29.8000], [1564329600000, 32.3700], [1564416000000, 50.1700], [1564502400000, 64.1200], [1564588800000, 55.0300], [1564675200000, 59.00], [1564934400000, 62.9100], [1565020800000, 61.2100], [1565107200000, 56.3600], [1565193600000, 61.9500], [1565280000000, 57.5200], [1565539200000, 91.8200], [1565625600000, 92.5200], [1565712000000, 93.0400], [1565798400000, 96.0400], [1565884800000, 95.8800], [1566144000000, 92.0300], [1566230400000, 90.8300], [1566316800000, 91.3800], [1566403200000, 90.8100], [1566489600000, 88.6600], [1566748800000, 89.2600], [1566835200000, 90.9200], [1566921600000, 94.9600], [1567008000000, 96.1500], [1567094400000, 97.3000], [1567353600000, 96.8400], [1567440000000, 95.2000], [1567526400000, 93.7500], [1567612800000, 93.1400], [1567699200000, 92.6000], [1567958400000, 91.9500], [1568044800000, 92.9700], [1568131200000, 95.1100], [1568217600000, 94.5800], [1568563200000, 94.5200], [1568649600000, 95.3600], [1568736000000, 95.2500], [1568822400000, 95.5900], [1568908800000, 96.7100], [1569168000000, 97.7700], [1569254400000, 97.6600], [1569340800000, 97.6600], [1569427200000, 98.6700], [1569513600000, 99.2800], [1569772800000, 99.2800], [1570464000000, 97.9600], [1570550400000, 97.9000], [1570636800000, 96.9100], [1570723200000, 96.3800], [1570982400000, 96.3700], [1571068800000, 97.3600], [1571155200000, 97.6900], [1571241600000, 98.5200], [1571328000000, 98.6300], [1571587200000, 99.0700], [1571673600000, 98.1400], [1571760000000, 98.7400], [1571846400000, 98.8500], [1571932800000, 98.6400], [1572192000000, 98.2000], [1572278400000, 98.5300], [1572364800000, 99.3500], [1572451200000, 99.3500], [1572537600000, 99.1900], [1572796800000, 99.0800], [1572883200000, 97.2900], [1572969600000, 97.6100], [1573056000000, 97.2900], [1573142400000, 98.4900], [1573401600000, 99.0800], [1573488000000, 99.2400], [1573574400000, 99.0300], [1573660800000, 99.0900], [1573747200000, 99.2500], [1574006400000, 99.0900], [1574092800000, 98.6000], [1574179200000, 98.7100], [1574265600000, 99.0400], [1574352000000, 99.2500], [1574611200000, 99.3600], [1574697600000, 99.2000], [1574784000000, 99.0400], [1574870400000, 98.7200], [1574956800000, 98.3100], [1575216000000, 98.1000], [1575302400000, 98.1000], [1575388800000, 99.00], [1575475200000, 99.00], [1575561600000, 98.4800], [1575820800000, 98.9500], [1575907200000, 98.4800], [1575993600000, 97.7500], [1576080000000, 98.0700], [1576166400000, 97.4500], [1576425600000, 93.1600], [1576512000000, 89.5200], [1576598400000, 90.1000], [1576684800000, 94.7700], [1576771200000, 96.6000], [1577030400000, 97.3100], [1577116800000, 97.00], [1577203200000, 94.4700], [1577289600000, 92.5000], [1577376000000, 93.6100], [1577635200000, 91.6300], [1577721600000, 91.0100], [1577894400000, 89.5200], [1577980800000, 89.3600], [1578240000000, 89.2700], [1578326400000, 88.8800], [1578412800000, 92.6700], [1578499200000, 91.6000], [1578585600000, 93.1500], [1578844800000, 93.0800], [1578931200000, 93.9500], [1579017600000, 93.5400], [1579104000000, 91.7500], [1579190400000, 91.1300], [1579449600000, 87.8700], [1579536000000, 87.6300], [1579622400000, 88.0600], [1579708800000, 90.7600]];
/*规模变动 mom-较上期环比*/
var Data_fluctuationScale = {
    "categories": ["2018-12-31", "2019-03-31", "2019-06-30", "2019-09-30", "2019-12-31"],
    "series": [{
        "y": 29.81,
        "mom": "-10.27%"
    }, {
        "y": 28.89,
        "mom": "-3.08%"
    }, {
        "y": 27.76,
        "mom": "-3.91%"
    }, {
        "y": 28.11,
        "mom": "1.26%"
    }, {
        "y": 33.26,
        "mom": "18.32%"
    }]
};
/*持有人结构*/
var Data_holderStructure = {
    "series": [{
        "name": "机构持有比例",
        "data": [99.95, 99.87, 99.91, 99.88]
    }, {
        "name": "个人持有比例",
        "data": [0.05, 0.13, 0.09, 0.12]
    }, {
        "name": "内部持有比例",
        "data": [0.0001, 0.0, 0.0021, 0.0002]
    }],
    "categories": ["2017-12-31", "2018-06-30", "2018-12-31", "2019-06-30"]
};
/*资产配置*/
var Data_assetAllocation = {
    "series": [{
        "name": "股票占净比",
        "type": null,
        "data": [0, 0, 0, 0],
        "yAxis": 0
    }, {
        "name": "债券占净比",
        "type": null,
        "data": [96.3, 100.17, 108.9, 107.85],
        "yAxis": 0
    }, {
        "name": "现金占净比",
        "type": null,
        "data": [0.03, 0.04, 2.1, 1.08],
        "yAxis": 0
    }, {
        "name": "净资产",
        "type": "line",
        "data": [32.1563119583, 30.6990515721, 30.4606539672, 34.5196830457],
        "yAxis": 1
    }],
    "categories": ["2019-03-31", "2019-06-30", "2019-09-30", "2019-12-31"]
};
/*业绩评价 ['选股能力', '收益率', '抗风险', '稳定性','择时能力']*/
var Data_performanceEvaluation = {
    "avr": "64.00",
    "categories": ["选证能力", "收益率", "抗风险", "稳定性", "管理规模"],
    "dsc": ["反映基金挑选证券而实现风险调整\u003cbr\u003e后获得超额收益的能力", "根据阶段收益评分，反映基金的盈利能力", "反映基金投资收益的回撤情况", "反映基金投资收益的波动性", "根据基金的资产规模评分"],
    "data": [60.0, 80.0, 50.0, 40.0, 80.0]
};
/*现任基金经理*/
var Data_currentFundManager = [{
    "id": "30410909",
    "pic": "https://pdf.dfcfw.com/pdf/H8_JPG30410909_1.jpg",
    "name": "李倩",
    "star": 4,
    "workTime": "4年又42天",
    "fundSize": "181.51亿(23只基金)",
    "power": {
        "avr": "61.34",
        "categories": ["经验值", "收益率", "抗风险", "稳定性", "管理规模"],
        "dsc": ["反映基金经理从业年限和管理基金的经验", "根据基金经理投资的阶段收益评分，反映\u003cbr\u003e基金经理投资的盈利能力", "反映基金经理投资的回撤控制能力", "反映基金经理投资收益的波动", "根据基金经理现任管理基金资产规模评分"],
        "data": [63.0, 89.40, 27.70, 24.80, 79.50],
        "jzrq": "2020-01-23"
    },
    "profit": {
        "categories": ["任期收益", "同类平均"],
        "series": [{
            "data": [{
                "name": null,
                "color": "#7cb5ec",
                "y": 30.4843
            }, {
                "name": null,
                "color": "#414c7b",
                "y": 12.12
            }]
        }],
        "jzrq": "2020-01-23"
    }
}];
/*申购赎回*/
var Data_buySedemption = {
    "series": [{
        "name": "期间申购",
        "data": [0.78, 0.02, 5.76, 9.41]
    }, {
        "name": "期间赎回",
        "data": [1.67, 1.20, 7.18, 6.02]
    }, {
        "name": "总份额",
        "data": [27.21, 26.04, 24.61, 28.00]
    }],
    "categories": ["2019-03-31", "2019-06-30", "2019-09-30", "2019-12-31"]
};
/*同类型基金涨幅榜（页面底部通栏）*/
var swithSameType = [['004222_金信民旺债券A_11.34', '004402_金信民旺债券C_11.30', '675011_西部利得稳健双利债券_7.86', '675013_西部利得稳健双利债券_7.83', '000297_鹏华可转债债券_7.34'], ['007372_国联安增瑞政策性金融_13.61', '005461_南方希元转债_13.41', '001045_华夏可转债增强债券A_13.10', '000297_鹏华可转债债券_12.43', '710301_富安达增强收益债券A_12.23'], ['005461_南方希元转债_25.47', '005480_诺安联创顺鑫C_20.56', '005448_诺安联创顺鑫A_19.97', '000297_鹏华可转债债券_19.75', '240018_华宝可转债债券A_19.16'], ['005461_南方希元转债_38.19', '003510_长盛可转债债券A_34.75', '003511_长盛可转债债券C_34.55', '240018_华宝可转债债券A_34.00', '050019_博时转债增强债券A_31.79'], ['320021_诺安双利债券发起_53.71', '470058_汇添富可转换债券A_33.53', '470059_汇添富可转换债券C_31.96', '002459_华夏鼎利债券发起式A_30.95', '002460_华夏鼎利债券发起式C_30.52']];

"""


def js_to_dict(js_code):
    """
    """

    detail_keyword = ["fS_name", "fS_code", "fund_sourceRate", "fund_Rate", "fund_minsg", "stockCodes", "zqCodes",
                      "stockCodesNew", "zqCodesNew", "syl_1n", "syl_6y", "syl_3y", "syl_1y "]
    need_keyword = ['Data_fundSharesPositions', 'Data_ACWorthTrend', 'Data_grandTotal', 'Data_rateInSimilarType',
                    'Data_rateInSimilarPersent', 'Data_fluctuationScale', 'Data_holderStructure',
                    'Data_assetAllocation', 'Data_performanceEvaluation', 'Data_currentFundManager',
                    'Data_buySedemption']
    ctx = execjs.compile(js_code)
    detail = {i: ctx.eval(i) for i in detail_keyword}
    data = {i: ctx.eval(i) for i in need_keyword}
    data['detail'] = detail
    return data


async def get_fund_data(fund_code: str):
    async with aiohttp.ClientSession() as session:
        async with session.get(FUND_DETAIL_URL.format(fund_code)) as response:
            if response.status == 200:
                res = await response.text()
            else:
                res = None
    if res:
        data = await asyncio.get_event_loop().run_in_executor(None, js_to_dict, res)
    else:
        data = None
    return data


async def get_fund_net_values(fund_code: str, page: int, page_size: int = 20):
    """
    :param fund_code:
    :param page:
    :param page_size:
    :return:
    http://api.fund.eastmoney.com/f10/lsjz
    ?callback=jQuery18301983556540064817_1580452922854&fundCode=002138&
    pageIndex=49&pageSize=20&startDate=&endDate=&_=1580453700917
    """
    params = {"fundCode": fund_code, "pageIndex": page, "pageSize": 20,
              "_": int(time.time() * 1000), "callback": "jQuery18301983556540064817_1580452922854"}
    async with aiohttp.ClientSession() as session:
        async with session.get(FUND_NET_VALUE_URL, params=params) as response:
            res = await response.text()
            print(response.url)
    print(res)


"""
http://fund.eastmoney.com/pingzhongdata/002138.js?v=20200131145914
"""

if __name__ == '__main__':
    loop = asyncio.get_event_loop()
    result = loop.run_until_complete(get_fund_data('002138'))
    loop.close()
